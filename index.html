<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC/USDT Real-time Monitor | Sunset Shimmer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            position: relative;
        }

        #header {
            position: fixed;
            top: 15px;
            left: 20px;
            z-index: 100;
        }

        #title {
            font-size: 14px;
            font-weight: 300;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 8px;
        }

        #price-display {
            font-size: 36px;
            font-weight: 700;
            transition: color 0.3s;
        }

            #price-display.up {
                color: #00ff9d;
            }

            #price-display.down {
                color: #ff3b5c;
            }

        #change {
            font-size: 16px;
            margin-top: 4px;
        }

        #chart-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            padding: 120px 20px 20px 20px;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
            cursor: move;
        }

        #pony-img {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 280px;
            height: auto;
            z-index: 50;
            filter: drop-shadow(0 0 20px rgba(255, 59, 92, 0.3));
            transition: all 0.4s ease;
            pointer-events: none;
        }

            #pony-img:hover {
                transform: scale(1.1);
                filter: drop-shadow(0 0 40px rgba(255, 59, 92, 0.6));
            }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
        }

        #error {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 59, 92, 0.2);
            color: #ff3b5c;
            padding: 10px 20px;
            border-radius: 5px;
            display: none;
            z-index: 200;
        }

        #controls {
            position: fixed;
            top: 15px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            color: #00ff9d;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

            .control-btn:hover {
                background: rgba(0, 255, 157, 0.2);
                border-color: #00ff9d;
            }

        /* Mobile optimization */
        @media (max-width: 768px) {
            #chart-container {
                padding: 100px 10px 160px 10px;
            }

            #price-display {
                font-size: 28px;
            }

            #title {
                font-size: 11px;
            }

            #pony-img {
                width: 180px;
                bottom: 10px;
                right: 10px;
            }

            #controls {
                top: auto;
                bottom: 200px;
                right: 10px;
                flex-direction: column;
            }

            .control-btn {
                padding: 6px 12px;
                font-size: 11px;
            }
        }

        /* Desktop optimization */
        @media (min-width: 1200px) {
            #pony-img {
                width: 320px;
                bottom: 30px;
                right: 30px;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="title">BTC/USDT LIVE MONITOR</div>
        <div id="price-display">--</div>
        <div id="change">--</div>
    </div>

    <div id="controls">
        <button class="control-btn" onclick="resetZoom()">Reset Zoom</button>
        <button class="control-btn" onclick="toggleInterval()">1m</button>
    </div>

    <div id="chart-container">
        <canvas id="myChart"></canvas>
    </div>

    <img id="pony-img" src="pony.png" alt="Sunset Shimmer monitoring the chart">

    <div id="loading">Connecting to Binance...</div>
    <div id="error"></div>

    <script>
        // ========== Global Variables ==========
        let chart;
        let candleData = [];
        let ws;
        let lastPrice = 0;
        let currentInterval = '1m';
        const intervals = ['1m', '3m', '5m', '15m', '30m', '1h'];
        let intervalIndex = 0;

        // ========== Initialize Chart ==========
        function initChart() {
        const ctx = document.getElementById('myChart').getContext('2d');
        chart = new Chart(ctx, {
        type: 'candlestick',
        data: {
        datasets: [{
        label: 'BTC/USDT',
        data: candleData,
        color: {
        up: '#00ff9d',
        down: '#ff3b5c',
        unchanged: '#666'
        },
        borderColor: {
        up: '#00ff9d',
        down: '#ff3b5c',
        unchanged: '#666'
        }
        }]
        },
        options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
        legend: {
        display: false
        },
        tooltip: {
        backgroundColor: 'rgba(0,0,0,0.8)',
        titleColor: '#fff',
        bodyColor: '#00ff9d',
        borderColor: '#333',
        borderWidth: 1
        },
        zoom: {
        pan: {
        enabled: true,
        mode: 'x',
        modifierKey: null
        },
        zoom: {
        wheel: {
        enabled: true,
        speed: 0.1
        },
        pinch: {
        enabled: true
        },
        mode: 'x'
        },
        limits: {
        x: {
        minRange: 60 * 1000 * 10 // Minimum 10 minutes
        }
        }
        }
        },
        scales: {
        x: {
        type: 'time',
        time: {
        unit: 'minute',
        displayFormats: {
        minute: 'HH:mm',
        hour: 'HH:mm'
        }
        },
        grid: {
        color: '#1a1a1a',
        drawBorder: false
        },
        ticks: {
        color: '#666',
        maxRotation: 0
        }
        },
        y: {
        position: 'right',
        grid: {
        color: '#1a1a1a',
        drawBorder: false
        },
        ticks: {
        color: '#666',
        callback: function(value) {
        return '$' + value.toLocaleString();
        }
        }
        }
        },
        interaction: {
        intersect: false,
        mode: 'index'
        }
        }
        });
        }

        // ========== Fetch Historical Data ==========
        async function fetchHistoricalData() {
        try {
        const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=${currentInterval}&limit=500`);
        const data = await response.json();

        candleData = data.map(d => ({
        x: d[0],
        o: parseFloat(d[1]),
        h: parseFloat(d[2]),
        l: parseFloat(d[3]),
        c: parseFloat(d[4])
        }));

        if (candleData.length > 0) {
        updatePriceDisplay(candleData[candleData.length - 1].c);
        }

        if (!chart) {
        initChart();
        } else {
        chart.data.datasets[0].data = candleData;
        chart.update();
        }

        document.getElementById('loading').style.display = 'none';
        connectWebSocket();
        } catch (error) {
        showError('Failed to fetch data: ' + error.message);
        }
        }

        // ========== WebSocket Connection ==========
        function connectWebSocket() {
        if (ws) {
        ws.close();
        }

        ws = new WebSocket(`wss://stream.binance.com:9443/ws/btcusdt@kline_${currentInterval}`);

        ws.onopen = () => {
        console.log('WebSocket connected');
        };

        ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        const kline = data.k;

        const newCandle = {
        x: kline.t,
        o: parseFloat(kline.o),
        h: parseFloat(kline.h),
        l: parseFloat(kline.l),
        c: parseFloat(kline.c)
        };

        const lastCandle = candleData[candleData.length - 1];
        if (lastCandle && lastCandle.x === newCandle.x) {
        candleData[candleData.length - 1] = newCandle;
        } else {
        candleData.push(newCandle);
        if (candleData.length > 500) {
        candleData.shift();
        }
        }

        updatePriceDisplay(newCandle.c);
        chart.update('none');
        };

        ws.onerror = (error) => {
        showError('WebSocket error');
        };

        ws.onclose = () => {
        console.log('WebSocket closed, reconnecting in 5s...');
        setTimeout(connectWebSocket, 5000);
        };
        }

        // ========== Update Price Display ==========
        function updatePriceDisplay(price) {
        const priceEl = document.getElementById('price-display');
        const changeEl = document.getElementById('change');

        priceEl.textContent = '$' + price.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
        });

        if (lastPrice > 0) {
        const change = ((price - lastPrice) / lastPrice * 100).toFixed(2);
        const changeText = change >= 0 ? `+${change}%` : `${change}%`;
        changeEl.textContent = changeText;
        priceEl.className = change >= 0 ? 'up' : 'down';
        }

        lastPrice = price;
        }

        // ========== Reset Zoom ==========
        function resetZoom() {
        if (chart) {
        chart.resetZoom();
        }
        }

        // ========== Toggle Interval ==========
        function toggleInterval() {
        intervalIndex = (intervalIndex + 1) % intervals.length;
        currentInterval = intervals[intervalIndex];
        document.querySelector('#controls .control-btn:nth-child(2)').textContent = currentInterval;
        document.getElementById('loading').style.display = 'block';
        fetchHistoricalData();
        }

        // ========== Show Error ==========
        function showError(message) {
        const errorEl = document.getElementById('error');
        errorEl.textContent = message;
        errorEl.style.display = 'block';
        setTimeout(() => {
        errorEl.style.display = 'none';
        }, 5000);
        }

        // ========== Start ==========
        fetchHistoricalData();
    </script>
</body>
</html>